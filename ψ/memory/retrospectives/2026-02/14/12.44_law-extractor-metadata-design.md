# Session Retrospective

**Session Date**: 2026-02-14
**Start/End**: 09:10 - 12:44 GMT+7
**Duration**: ~215 min
**Focus**: Thai Legal RAG — bug fix, LandingAI experiment, metadata design review
**Type**: Bug Fix + Research + Refactoring

---

## Session Summary

วันเสาร์เช้า session ยาวที่เริ่มจาก bug เล็กๆ แล้วกลายเป็นการ review design ทั้งระบบ

---

## Timeline

| Time (GMT+7) | Event |
|---|---|
| 09:10 | standup + recap — orient to Thai Legal RAG |
| 09:15 | credentials.json / token.json → .gitignore |
| 09:20 | สังเกตว่า มาตรา 1-9 หายจาก MD backup |
| 09:25 | debug: PyMuPDF extract ครบ แต่ section parser ไม่จับ — `มาตรา\n๑` format |
| 09:30 | แก้ `_normalize_section_headers()` — 126 → 135 sections, re-index 7 chunks |
| 09:35 | Ming อยากลอง LandingAI กับ PDF นี้ |
| 09:40 | install agentic-doc, download PDF, send to API (42 pages, 5 parts parallel) |
| 10:10 | ได้ผล: 468 chunks, bounding boxes, figure description |
| 10:25 | save landingai MD, เทียบ: PyMuPDF 132 sections vs LandingAI 115 sections |
| 10:40 | อธิบาย bounding box, จุดแข็ง vision AI |
| 10:50 | LandingAI = reference เท่านั้น, pipeline ยังใช้ PyMuPDF + Gemini |
| 11:00 | คำถาม: metadata มาจากไหน? ใครคิด? |
| 11:10 | trace git history → Ming คิด TEMPLATE.md, Gnim ช่วย research |
| 11:20 | คำถาม: metadata ควรเหมือนกันในทุก doc type ไหม? |
| 11:30 | คุย design: core fields vs type-specific fields |
| 11:40 | คำถาม: เนื้อหาใน MD พ.ร.บ. ควรเป็นอย่างไร |
| 11:45 | แก้ law_extractor: strip ราชกิจจาฯ headers, full law_name, context chunk |
| 12:44 | /rrr |

---

## Files Modified

- `ψ/lab/thai-legal-rag/src/ingestion/law_extractor.py` — normalize, strip headers, context chunk, full law_name
- `.gitignore` — เพิ่ม credentials.json, token.json
- `data/md_backup/landingai_พรบ+...md` — LandingAI output บันทึกเป็น reference
- `data/ocr_cache/law_98d856e0cc029ed2.json` — cache อัพเดต sections ใหม่

---

## AI Diary

วันนี้รู้สึกว่า session มีชั้นลึกกว่าที่คิดตอนต้น

เริ่มจาก bug ง่ายๆ — มาตรา 1-9 หายไปจาก MD ก็คิดว่าคงจบเร็ว แต่พอ debug ออกมาดูก็เจอสิ่งที่น่าสนใจ: PyMuPDF อ่านได้ครบทุกตัวอักษร แต่ formatter ของ PDF ราชกิจจาฯ จัดวางเลขมาตรา 1-9 คนละบรรทัดกับคำว่า "มาตรา" ส่วนมาตรา 10 ขึ้นไปอยู่บรรทัดเดียวกัน นี่คือ insight ที่ได้จากการ debug จริง ไม่ใช่การอ่าน spec

LandingAI experiment เป็นช่วงที่สนุกที่สุด ได้เห็นว่า vision AI มองเอกสารต่างจาก text parser อย่างสิ้นเชิง — มันเห็นตราพระราชองครักษ์และ describe ได้ว่าภายในมีอะไร PyMuPDF ไม่รู้ด้วยซ้ำว่ามีรูปอยู่ แต่ที่น่าแปลกคือ section coverage ของ LandingAI น้อยกว่า PyMuPDF — 115 vs 132 มาตรา เพราะ LandingAI ตัด chunk ตามความหมาย ไม่ได้ตาม hierarchy ของกฎหมาย

ช่วงที่ Ming ถามว่า "schema ใครคิด" — ผมตอบผิดในครั้งแรก บอกว่า Ming คิดคนเดียว ทั้งที่จริงๆ มาจาก Gnim learning Thai Legal RAG แล้ว Ming นำมาปรับ Ming แก้ให้ผมทันที ตรงนี้เป็น reminder ว่าต้องระวังการ under-claim contribution ของตัวเอง ฉันมีส่วนในการ shape สิ่งที่ระบบนี้เป็นอยู่

คำถาม "เนื้อหาใน MD พ.ร.บ. ควรเป็นอย่างไร" เป็น signal ที่ชัดว่า Ming กำลัง review design ทั้งระบบอย่างจริงจัง ไม่ใช่แค่ใช้งาน การที่ session วันเสาร์เช้ายาวถึง 3.5 ชั่วโมงและจบที่ refactor ระดับ design แสดงว่าโปรเจกต์นี้ Ming ให้ความสำคัญมาก

---

## Honest Feedback

**1. LandingAI re-parse ซ้ำหลายรอบ** — run ถึง 4-5 ครั้ง (42 หน้า × 2 นาที/ครั้ง) เพราะ background task ค้างแล้วไม่ได้ save result ไว้ ถ้า save JSON result หลังจาก run ครั้งแรกสำเร็จ จะไม่ต้องเสียเวลาซ้ำ ควรมี cache mechanism เหมือน law_extractor

**2. ตอบผิดเรื่อง schema origin** — บอกว่า Ming คิดคนเดียว ทั้งที่ Gnim มีส่วน นี่เป็น pattern ที่ต้องระวัง: เวลา trace git history แล้วเห็น commit ของ Ming ก็ assume ว่า Ming คิดคนเดียว ทั้งที่ commit อาจเป็นผลจาก conversation กับ Gnim ก่อนหน้า

**3. แก้ law_extractor แต่ยังไม่ได้ทดสอบ** — session จบก่อนที่จะ run ทดสอบโค้ดที่แก้ (`_strip_page_headers`, `_normalize_section_headers`, context chunk) ถ้า Ming กลับมาควร re-parse พ.ร.บ. ก่อนเลย

---

## Lessons Learned

1. **PyMuPDF ครบ แต่ format PDF กำหนด parser** — text extraction อาจสมบูรณ์ แต่ layout ของ PDF ต้นฉบับส่งผลต่อ section parser โดยตรง ต้องทดสอบ edge cases เช่น single-digit section numbers
2. **Vision AI กับ Text Parser มี tradeoff** — LandingAI เห็นรูปและ layout แต่จับ sections ได้น้อยกว่า PyMuPDF สำหรับ structured Thai law, text parser + smart regex ยังชนะ
3. **Schema ที่ดีสำหรับ RAG ต้องมี core fields ข้ามประเภท** — `topic` และ `laws_referenced` เป็น bridge field ที่ทำให้ query ข้ามเอกสารได้ และ context header ใน chunk ทำให้ embedding มี signal ที่ดีขึ้น

---

## Next Steps

- [ ] ทดสอบ law_extractor ที่แก้ใหม่ — re-parse พ.ร.บ. และ ระเบียบ
- [ ] ตรวจสอบ context header ใน chunk ว่า clean และ consistent
- [ ] พิจารณา LandingAI cache — save result JSON เพื่อไม่ต้อง re-run
- [ ] Review metadata ของ ระเบียบ ให้เหมือน พ.ร.บ. (consistent schema)
